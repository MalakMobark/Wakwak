<!DOCTYPE html>
<html lang="en" dir="rtl">

    <head>
        <meta charset="utf-8">
        <title>WAK WAK</title>
        <link rel="icon" type="image/png" href="img/wak-wak-w-back-1.png">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta content="" name="keywords">
        <meta content="" name="description">

        <!-- Google Web Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Raleway:wght@600;800&display=swap" rel="stylesheet"> 

        <!-- Icon Font Stylesheet -->
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"/>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

        <!-- Libraries Stylesheet -->
        <link href="lib/lightbox/css/lightbox.min.css" rel="stylesheet">
        <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">


        <!-- Customized Bootstrap Stylesheet -->
        <link href="css/bootstrap.min.css" rel="stylesheet">

        <!-- Template Stylesheet -->
        <link href="css/style.css" rel="stylesheet">
    </head>

    <body>

        <!-- Spinner Start -->
        <div id="spinner" class="show w-100 vh-100 bg-white position-fixed translate-middle top-50 start-50  d-flex align-items-center justify-content-center">
            <div class="spinner-grow text-primary" role="status"></div>
        </div>
        <!-- Spinner End -->

<!-- Navbar start -->
<div class="container-fluid fixed-top">                           
    <div class="container px-0">
        <nav class="navbar navbar-light bg-white navbar-expand-xl d-flex justify-content-between">
            <div class="d-flex m-3 me-0">
                    <a href="cart.html" class="position-relative me-4 my-auto">
                        <i class="fa fa-shopping-bag fa-2x" style="color: #f3c20e;"></i>
                        <span id="cart-counter" class="position-absolute rounded-circle d-flex align-items-center justify-content-center text-white p-1" style="top: -10px; left: 18px; height: 25px; min-width: 25px; background-color: #f36f28 !important;">0</span>
                    </a>
                </div>
            <a href="index.html" class="navbar-brand">
                <img src="img/wak-wak-w-back-1.png" alt="WAK WAK" style="height: 70px;">
            </a>
            <button class="navbar-toggler py-2 px-3" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
                <span class="fa fa-bars text-primary"></span>
            </button>
            <div class="collapse navbar-collapse bg-white" id="navbarCollapse">
                <div class="navbar-nav me-xl-auto">
                    <a href="index.html" class="nav-item nav-link ">الصفحة الرئيسية</a>
                    <a href="all_clothes.html" class="nav-item nav-link"> جميع الملابس </a>
                    <a href="clothes_woman.html" class="nav-item nav-link ">ملابس نسائية </a>
                    <a href="clothes_man.html" class="nav-item nav-link">ملابس رجالية </a>
                    <a href="salles.html" class="nav-item nav-link">عروضنا </a>
                    <a href="#contact_us" class="nav-item nav-link">التواصل معنا</a>
                    <!-- <a href="shop.html" class="nav-item nav-link">Shop</a> -->
                    <!-- <a href="shop-detail.html" class="nav-item nav-link">Shop Detail</a> -->
                    <!-- <div class="nav-item dropdown"> -->
                        <!-- <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">Pages</a> -->
                        <!-- <div class="dropdown-menu m-0 bg-secondary rounded-0"> -->
                            <!-- <a href="cart.html" class="dropdown-item">Cart</a> -->
                            <!-- <a href="chackout.html" class="dropdown-item">Chackout</a> -->
                            <!-- <a href="testimonial.html" class="dropdown-item">Testimonial</a> -->
                            <!-- <a href="404.html" class="dropdown-item">404 Page</a> -->
                        <!-- </div> -->
                    <!-- </div> -->
                    
                </div>
            </div>
            
        </nav>
    </div>
</div>
<!-- Navbar End -->
        <!-- Cart Page Start -->
         <div class="container-fluid py-2 content-buffer">
    <div class="container mx-auto px-4 py-5">
        <!-- العنوان المطلوب في المنتصف -->
         <div class="text-center mb-5"></div>
        <h2 class="fw-bold text-center mb-5">محتوى السلة</h2>
        
        <div class="row g-4">
            
            <!-- العمود الرئيسي لعناصر السلة -->
            <div class="col-lg-8" id="cart-items-container">
                
                <!-- 
                    ===============================================
                    1. منطقة عرض عناصر السلة (JS ستملأ هذا العنصر)
                    ===============================================
                    في وضع الويب (Desktop)، سيتم وضع البطاقات بجوار بعضها البعض (كل 2 في صف).
                    في وضع الموبايل، سيتم وضعها تحت بعضها البعض.
                    
                    ملاحظة: هذا الـ ID هو الحاوية التي يجب أن يضع فيها JavaScript البطاقات.
                    نحن نستخدم "row g-3" لإضافة تباعد بين البطاقات.
                -->
                <div class="row g-3" id="cart-items-table">
                    
                    <!-- مثال على بطاقة منتج واحد (يجب على JS أن يولد مثل هذه البطاقات) -->
                    <!-- في الويب، ستظهر بطاقتان جنبًا إلى جنب (col-md-6) -->
                    <div class="col-12 col-md-6">
                        <div class="cart-item-card d-flex">
                            
                            <!-- 1. زر الحذف (سلة حمراء) - في الزاوية المقابلة للصورة -->
                            <button class="btn-remove-item" data-id="123" data-action="remove-item">
                                <i class="fa fa-trash-alt"></i>
                            </button>
                            
                            <!-- 2. الصورة (على اليسار) -->
                            <div class="flex-shrink-0 me-3">
                                <img src="https://placehold.co/100x100/f8f9fa/6c757d?text=صورة" class="product-img" alt="اسم المنتج">
                            </div>
                            
                            <!-- 3. التفاصيل -->
                            <div class="flex-grow-1 product-details-body">
                                <!-- الاسم -->
                                <p class="fw-bold product-name mb-1">كنزة هودي (مثال)</p>
                                
                                <!-- المقاس (تحت الاسم بخط صغير) -->
                                <p class="small text-secondary product-size mb-1">القياس: XL</p>
                                
                                <hr class="my-1 card-separator">
                                
                                <!-- السعر والكمية (على نفس المحاذاة الأفقية) -->
                                <div class="d-flex justify-content-between align-items-center mt-2">
                                    
                                    <!-- السعر بخط أكبر شوي -->
                                    <p class="fw-bolder fs-5 text-primary mb-0">99.99 $</p>
                                    
                                    <!-- الكمية (الزرين) -->
                                    <div class="quantity-controls d-flex align-items-center">
                                        <button class="btn btn-sm btn-outline-secondary js-quantity-plus" data-id="123" data-action="plus">+</button>
                                        <input type="text" class="form-control form-control-sm text-center quantity-input" value="1" readonly data-id="123">
                                        <button class="btn btn-sm btn-outline-secondary js-quantity-minus" data-id="123" data-action="minus">-</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div> 
                    <!-- نهاية بطاقة المنتج المثالية -->
                    
                </div>
                <!-- نهاية منطقة عرض عناصر السلة -->
                
            </div>
            
            <!-- 
                ===============================================
                2. ملخص الطلب
                ===============================================
                هذا الجزء لم يتغير لضمان بقاء الـ IDs (subtotal, grand-total) وزر الإتمام (checkout-btn)
            -->
            <div class="col-lg-4">
                <div class="sticky-top" style="top: 20px;">
                    <div class="border p-4 rounded-3 bg-light shadow-sm">
                        <h5 class="mb-3 fw-bold">ملخص الطلب</h5>
                        <div class="d-flex justify-content-between mb-2 pb-2 border-bottom">
                            <span>المجموع الفرعي:</span>
                            <span id="subtotal-display" class="fw-bold">0.00 $</span>
                        </div>
                        <div class="d-flex justify-content-between mb-4">
                            <span class="fw-bold">المجموع الكلي:</span>
                            <span id="grand-total-display" class="fw-bold text-primary">0.00 $</span>
                        </div>
                        <!-- زر إتمام الطلب مربوط بنفس الـ modal target -->
                        <button type="button" class="btn w-100 btn-custom-outline fw-bold py-2" data-bs-toggle="modal" data-bs-target="#checkoutModal" id="checkout-btn">
                            <i class="fa fa-money-bill me-2"></i> إتمام الطلب
                        </button>
                    </div>
                </div>
            </div>
            
        </div>
        
    </div>
</div>

        <!-- Cart Page End -->

<div class="modal fade" id="checkoutModal" tabindex="-1" aria-labelledby="checkoutModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="checkoutModalLabel"><i class="fa fa-truck me-2"></i> استكمال معلومات طلب وَا<span style="color: #f36f28;">ك</span> وَا<span style="color: #f36f28;">ك</span></h5>
            </div>
            <div class="modal-body">
                <form id="checkout-form" class="row g-3 needs-validation" novalidate 
                   >
            
                    <div class="col-md-6">
                        <label for="fullName" class="form-label">الاسم الكامل <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="customer-name" name="الاسم_الكامل" placeholder="ادخل اسمك الثلاثي من فضلك" required>
                        <div class="invalid-feedback">
                            الرجاء إدخال الاسم الكامل.
                        </div>
                    </div>

                    <div class="col-md-6">
                        <label for="phoneNumber" class="form-label">رقم الهاتف <span class="text-danger">*</span></label>
                        <input type="tel" class="form-control" id="customer-phone" name="رقم_الهاتف" placeholder="ادخل الرقم من فضلك" required pattern="[0-9]{10}">
                        <div class="invalid-feedback">
                            الرجاء إدخال رقم هاتف صحيح (10 أرقام).
                        </div>
                    </div>

                    <div class="col-12">
                        <label for="address" class="form-label">عنوان السكن بالتفصيل <span class="text-danger">*</span></label>
                        <textarea class="form-control" id="customer-address" name="عنوان_الشحن" rows="3" placeholder="المدينة، الحي، الشارع، أقرب معلم" required></textarea>
                        <div class="invalid-feedback">
                            الرجاء إدخال عنوان الشحن.
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <label for="discountCode" class="form-label">كود الحسم (اختياري)</label>
                        <input type="text" class="form-control" id="discountCode" name="كود_الحسم" placeholder="ادخل الكود هنا إن وجد">
                    </div>

                    <div class="col-md-6">
                        <label for="notes" class="form-label">ملاحظات إضافية (اختياري)</label>
                        <textarea class="form-control" id="notes" name="ملاحظات_إضافية" rows="1" placeholder="مثال: يفضل التوصيل في الفترة المسائية"></textarea>
                    </div>
                    
                    <hr class="my-4">
                    
                    <div class="col-12 text-center">
                        <h5 class="mb-3">هل تريد تأكيد الطلب؟</h5>
                        <button type="button" class="btn px-4 mx-2" data-bs-dismiss="modal">لا</button>
                        <button type="submit" id="submit-order-btn" class="btn btn-submit-final px-4 mx-2">نعم، تأكيد</button>
                    </div>

                </form>
            </div>
        </div>
    </div>
</div>


        <!-- Footer Start -->
         <div class="container-fluid text-white-50 footer pt-1 mt-1" style="background-color: #343a40;">
    <div class="container py-5">
        <div class="pb-4 mb-4" style="border-bottom: 1px solid rgba(226, 175, 24, 0.5) ;">
            <div class="row g-4">
                <div class="col-lg-3">
                    <a href="#">
                        <!-- 2. تم تغيير الاسم وتلوين حرف الكاف -->
                        <h1 class="mb-0" style="color: #f3c20e;">متجر وَا<span style="color: #f36f28;">ك</span> وَا<span style="color: #f36f28;">ك</span></h1>
                        <p class="mb-0" style="color: #f3c20e;">ملابس بروح مرحة</p>
                    </a>
                </div>
                <div class="col-lg-6">
                    <div class="position-relative mx-auto">
                        <input class="form-control border-0 w-100 py-3 px-4 rounded-pill" type="email" placeholder="بريدك الإلكتروني">
                        <!-- 1. تم تغيير كلمة "Subscribe Now" -->
                        <button type="submit" class="btn border-0 py-3 px-4 position-absolute rounded-pill text-white" style="top: 0; right: 0; background-color: #f36f28;">تسجيل دخول</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="row g-5">

<div class="row g-5">
    <!-- --- القسم الأول: لماذا واك واك؟ --- -->
    <div class="col-lg-3 col-md-6">
        <div class="footer-item">
            <h4 class="text-light mb-3">لماذا وَا<span style="color: #f36f28;">ك</span> وَا<span style="color: #f36f28;">ك</span>؟</h4>
            <p class="mb-4">لأننا نؤمن أن الملابس هي أكثر من مجرد قماش. في واك واك، نصمم كل قطعة لتعكس روحك المرحة، باستخدام أجود الخامات لنوفر لك الراحة والأناقة في كل يوم.</p>
        </div>
    </div>

    <!-- --- القسم الثاني: التواصل معنا --- -->
    <div class="col-lg-3 col-md-6">
        <div class="d-flex flex-column text-end footer-item">
            <h4 class="text-light mb-3">التواصل معنا</h4>
            <a class="btn-link" href="tel:+963945916586"><i class="fas fa-phone me-2"></i>+963945916586</a>
            <a class="btn-link" href="#"><i class="fab fa-facebook-f me-2"></i>فيسبوك</a>
            <a class="btn-link" href="#"><i class="fab fa-instagram me-2"></i>انستغرام</a>
        </div>
    </div>

    <!-- --- القسم الثالث: سياسة التوصيل --- -->
    <div class="col-lg-3 col-md-6">
        <div class="footer-item">
            <h4 class="text-light mb-3">سياسة التوصيل</h4>
            <p class="mb-4">بعد تأكيد طلبك، سيتم التواصل معك خلال 24 ساعة. نهدف لتوصيل طلبك خلال أربعة أيام عمل.</p>
        </div>
    </div>

    <!-- --- القسم الرابع: الترجيع والتبديل --- -->
    <div class="col-lg-3 col-md-6">
        <div class="footer-item">
            <h4 class="text-light mb-3">الترجيع والتبديل</h4>
            <p class="mb-4">يمكنك إرجاع المنتجات خلال 3 أيام من تاريخ الاستلام، أو تبديلها خلال 4 أيام.</p>
        </div>
    </div>
</div>


            </div>
        </div>
    </div>
</div>

        <!-- Footer End -->




        <!-- Back to Top -->
        <a href="#" class="btn btn-primary border-3 border-primary rounded-circle back-to-top"><i class="fa fa-arrow-up"></i></a>   

        
    <!-- JavaScript Libraries -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/lightbox/js/lightbox.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>

    <!-- Template Javascript -->
    <script src="js/main.js"></script>
    
    <script>

        // 1. دالة تحديث عداد السلة (تم نسخها من الكود السابق)
function updateCartCounter() {
    let cart = JSON.parse(localStorage.getItem('shoppingCart') || '[]');
    const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
    const counterElement = document.getElementById('cart-counter');
    
    if (counterElement) {
        counterElement.textContent = totalItems.toString();
    }
}

// 2. الدوال المساعدة (الحذف، تحديث الكمية)
function removeFromCart(uniqueKey) {
    let cart = JSON.parse(localStorage.getItem('shoppingCart') || '[]');
    cart = cart.filter(item => item.uniqueKey !== uniqueKey); 
    localStorage.setItem('shoppingCart', JSON.stringify(cart));
    renderCart(); // إعادة عرض السلة بعد التعديل
}

// * دالة لإظهار رسالة تأكيد مخصصة (بدلاً من alert/confirm)
function showCustomConfirmation(message, onConfirm) {
    // بما أننا لا نستطيع استخدام confirm()، يجب أن نستخدم منطق واجهة المستخدم
    // هنا، سنعتمد على أن الزر (سلة الحذف) يفترض الموافقة. 
    // إذا كنتِ تريدين رسالة تأكيد، يجب إضافة Modal (نافذة منبثقة) لعملية التأكيد.
    // للحفاظ على بساطة الكود الآن، سنقوم بالحذف مباشرة إذا كانت الكمية صفر أو أقل.
    onConfirm();
}


function updateQuantity(uniqueKey, change) {
    let cart = JSON.parse(localStorage.getItem('shoppingCart') || '[]');
    const itemIndex = cart.findIndex(item => item.uniqueKey === uniqueKey);
    
    if (itemIndex !== -1) {
        let currentQuantity = cart[itemIndex].quantity;
        let newQuantity = currentQuantity + change;
        
        if (newQuantity < 1) {
            // ملاحظة هامة: تم استبدال (if (confirm(...))) بمنطق الحذف المباشر لتجنب مشاكل الـ iFrame
            // إذا كانت الكمية الجديدة أقل من 1، نقوم بالحذف
            showCustomConfirmation("هل تريد بالتأكيد إزالة هذا المنتج من السلة؟", () => {
                 removeFromCart(uniqueKey);
            });
            return;
        }
        cart[itemIndex].quantity = newQuantity;
        // تحديث السعر الكلي للقطعة
        cart[itemIndex].totalPrice = newQuantity * cart[itemIndex].price; 
        localStorage.setItem('shoppingCart', JSON.stringify(cart));
        renderCart();
    }
}

// 3. دالة إرفاق مستمعي الأحداث لأزرار السلة
// تم تعديل الكلاسات لاستخدام الكلاسات الجديدة التي أرفقناها في الـ HTML
function attachCartListeners() {
    // 1. أزرار الحذف (السلة الحمراء) - الآن تستخدم الكلاس .btn-remove-item
    document.querySelectorAll('.btn-remove-item').forEach(button => {
        button.addEventListener('click', function() {
            // يتم استخدام data-id بدلاً من data-key ولكننا سنحافظ على data-key للتوافق
            removeFromCart(this.getAttribute('data-id') || this.getAttribute('data-key')); 
        });
    });
    
    // 2. أزرار نقصان الكمية - الكلاس .minus-btn
    document.querySelectorAll('.minus-btn').forEach(button => {
        button.addEventListener('click', function() {
            updateQuantity(this.getAttribute('data-key'), -1);
        });
    });
    
    // 3. أزرار زيادة الكمية - الكلاس .plus-btn
    document.querySelectorAll('.plus-btn').forEach(button => {
        button.addEventListener('click', function() {
            updateQuantity(this.getAttribute('data-key'), 1);
        });
    });
}

// 4. دالة عرض محتويات السلة - تم تحديثها لتوليد هيكل البطاقات
function renderCart() {
    const cartItemsContainer = document.getElementById('cart-items-table');
    const subtotalDisplay = document.getElementById('subtotal-display');
    const grandTotalDisplay = document.getElementById('grand-total-display');
    
    let cart = JSON.parse(localStorage.getItem('shoppingCart') || '[]');
    let subtotal = 0;
    
    cartItemsContainer.innerHTML = ''; // مسح المحتويات القديمة
    
    if (cart.length === 0) {
        // رسالة سلة فارغة (في حالة عدم وجود سلة)
        cartItemsContainer.innerHTML = '<div class="col-12 text-center py-5 border rounded-3 text-secondary">سلة المشتريات فارغة حالياً. ابدأ التسوق!</div>';
        subtotalDisplay.textContent = '0.00 $';
        grandTotalDisplay.textContent = '0.00 $';
        updateCartCounter();
        return;
    }
    
    cart.forEach(item => {
        subtotal += item.totalPrice; 
        
        // الهيكل الخارجي للبطاقة (يسمح بـ 2 كاردات في الصف للويب)
        const itemColumn = document.createElement('div');
        itemColumn.className = 'col-12 col-md-6'; // 100% عرض على الموبايل، 50% عرض على الويب
        
        // محتوى البطاقة الداخلي
        itemColumn.innerHTML = `
            <div class="cart-item-card d-flex">
                
                <!-- 1. زر الحذف (السلة الحمراء) - data-id و data-key للحذف -->
                <button class="btn-remove-item" data-id="${item.uniqueKey}" data-key="${item.uniqueKey}">
                    <i class="fa fa-trash-alt fa-lg"></i>
                </button>
                
                <!-- 2. الصورة (على اليسار) -->
                <div class="flex-shrink-0 me-3">
                    <img src="${item.imageUrl || 'https://placehold.co/100x100/f8f9fa/6c757d?text=صورة'}" class="product-img" alt="${item.name}">
                </div>
                
                <!-- 3. التفاصيل -->
                <div class="flex-grow-1 product-details-body">
                    <!-- الاسم -->
                    <p class="fw-bold product-name mb-1">${item.name}</p>
                    
                    <!-- المقاس واللون بخط صغير -->
                    <p class="small text-secondary product-size mb-1">
                        القياس: <span class="fw-semibold">${item.size}</span> | اللون: <span class="fw-semibold">${item.color}</span>
                    </p>
                    
                    <hr class="my-1 card-separator">
                    
                    <!-- السعر والكمية (على نفس المحاذاة الأفقية) -->
                    <div class="d-flex justify-content-between align-items-center mt-2">
                        
                        <!-- السعر بخط أكبر شوي (يستخدم السعر الكلي للقطعة) -->
                        <p class="fw-bolder fs-5 text-primary mb-0">${item.totalPrice.toFixed(2)} $</p>
                        
                        <!-- الكمية (الزرين) -->
                        <div class="quantity-controls d-flex align-items-center">
                            <!-- زر النقصان - يستخدم الكلاس .minus-btn والـ data-key -->
                            <button class="btn btn-sm btn-outline-secondary minus-btn" type="button" data-key="${item.uniqueKey}">-</button>
                            
                            <!-- حقل الكمية -->
                            <input type="text" class="form-control form-control-sm text-center quantity-input" value="${item.quantity}" readonly>
                            
                            <!-- زر الزيادة - يستخدم الكلاس .plus-btn والـ data-key -->
                            <button class="btn btn-sm btn-outline-secondary plus-btn" type="button" data-key="${item.uniqueKey}">+</button>
                        </div>
                    </div>
                </div>
            </div>
        `;
        cartItemsContainer.appendChild(itemColumn);
    });
    
    // عرض المجاميع
    subtotalDisplay.textContent = `${subtotal.toFixed(2)} $`;
    grandTotalDisplay.textContent = `${subtotal.toFixed(2)} $`;
    
    updateCartCounter(); // تحديث العداد
    attachCartListeners(); // تفعيل أزرار الحذف والتعديل
}

// 5. استدعاء الدوال عند تحميل الصفحة
document.addEventListener('DOMContentLoaded', function() {
    renderCart(); // هذا هو المفتاح!
});



// =========================================================
// دالة تجميع البيانات وإعدادها للإرسال (الإصدار النهائي لـ Formspree)
// =========================================================
function processCheckout(event) {
    // منع الإرسال الافتراضي للنموذج
    event.preventDefault();

    // التأكد من التحقق من صحة النموذج (Bootstrap validation)
    const form = document.getElementById('checkout-form');
    if (!form.checkValidity()) {
        event.stopPropagation();
        form.classList.add('was-validated');
        alert("الرجاء ملء جميع الحقول المطلوبة بشكل صحيح.");
        return;
    }
    form.classList.remove('was-validated');


    // 1. قراءة بيانات الزبون من الـ Modal
    const customerName = document.getElementById('customer-name').value;
    const customerPhone = document.getElementById('customer-phone').value;
    const customerAddress = document.getElementById('customer-address').value;
    const discountCode = document.getElementById('discountCode').value || 'لا يوجد';
    const notes = document.getElementById('notes').value || 'لا توجد ملاحظات';
    
    // 2. قراءة بيانات السلة من localStorage
    const cart = JSON.parse(localStorage.getItem('shoppingCart') || '[]');
    
    if (cart.length === 0) {
        alert("عذراً، سلة المشتريات فارغة لإرسال الطلب.");
        return;
    }

    let subtotal = 0;
    
    // 3. تهيئة تفاصيل السلة كنص واضح (Text Body)
    let cartBodyText = "========== تفاصيل السلة ==========\n";
    cart.forEach((item, index) => {
        subtotal += item.totalPrice;
        cartBodyText += `المنتج #${index + 1}: ${item.name}\n`;
        cartBodyText += `  - اللون/المقاس: ${item.color} / ${item.size}\n`;
        cartBodyText += `  - الكمية: ${item.quantity}\n`;
        cartBodyText += `  - السعر للوحدة: ${item.price.toFixed(2)} $\n`; // إضافة سعر الوحدة لتفاصيل أوضح
        cartBodyText += `  - المجموع الجزئي: ${item.totalPrice.toFixed(2)} $\n`;
        cartBodyText += `------------------------------------------------\n`;
    });
    
  const dataToSend = {
        'from_name': customerName, // اسم العميل
        'phone': customerPhone, // رقم الهاتف
        'address': customerAddress, // العنوان المفصل
        'discount_code': discountCode, // كود الحسم
        'customer_notes': notes, // ملاحظات الزبون
        '_subject': `طلب جديد من متجر واك واك: ${customerName}`, // عنوان الرسالة
        'order_details_text': cartBodyText, // تفاصيل السلة كنص
        'grand_total': subtotal.toFixed(2), // المجموع الكلي (كرقم فقط)
    };
    
    console.log("البيانات النهائية للإرسال:", dataToSend);

    // الخطوة 5: استدعاء خدمة الإرسال الخارجية
    sendDataToEmailService(dataToSend);
}







// ربط الدالة بزر الإرسال
document.addEventListener('DOMContentLoaded', function() {
    // ... باقي الدوال التي لديك ...

    const checkoutForm = document.getElementById('checkout-form');
    if (checkoutForm) {
        checkoutForm.addEventListener('submit', processCheckout);
    }
});

// دالة وهمية للخطوة القادمة (الإرسال الفعلي)
function sendDataToEmailService(orderData) {
    
    const formspreeEndpoint = "https://formspree.io/f/xanpjzyz";
    
    // 1. عرض رسالة تحميل مؤقتة
    const submitBtn = document.getElementById('submit-order-btn');
    submitBtn.textContent = 'جاري إرسال الطلب...';
    submitBtn.disabled = true;

    // تهيئة البيانات للإرسال (يجب أن تكون Formspree البيانات كـ JSON)
    // ملاحظة: Formspree ستقوم بإنشاء حقول بناءً على المفاتيح التي ترسلها.
    const dataToSendForFormspree = {
        '_subject': orderData._subject, // عنوان الرسالة
        'الاسم_الكامل': orderData.from_name,
        'رقم_الهاتف': orderData.phone,
        'العنوان_المفصل': orderData.address,
        'كود_الحسم': orderData.discount_code,
        'ملاحظات_الزبون': orderData.customer_notes,
        // **هذا هو الحقل الذي سيحتوي على تفاصيل السلة كنص**
        'تفاصيل_المنتجات_المطلوبة': orderData.order_details_text, 
        'المجموع_الكلي': orderData.grand_total + ' $',
    };
    
    // 2. استخدام دالة fetch للإرسال إلى Formspree
    fetch(formspreeEndpoint, {
        method: 'POST',
        headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(dataToSendForFormspree)
    })
    .then(response => {
         if (response.ok) {
            
            // 3. حالة النجاح
            
            // الخطوة 1: مسح السلة من الـ Local Storage (الخطوة المفقودة)
            localStorage.removeItem('shoppingCart'); 
            
            // الخطوة 2 (اختيارية): إغلاق النافذة المنبثقة يدوياً (يجب أن تكون قبل إعادة التوجيه)
            const modalElement = document.getElementById('checkoutModal'); 
            // تحقق ما إذا كان الـ modal قد تم إنشاؤه بالفعل
            const modalInstance = bootstrap.Modal.getInstance(modalElement);
            if (modalInstance) {
                modalInstance.hide();
            } else {
                new bootstrap.Modal(modalElement).hide();
            }

           
           
           
            // الخطوة 4: إعادة التوجيه إلى صفحة الشكر (يجب أن تكون آخر خطوة)
            window.location.href = 'thank_you.html'; 
            
            // **ملاحظة:** تم حذف استدعاء renderCart() لأنه لا يعمل بعد إعادة التوجيه.
            
            
        } else {
            // حالة فشل الإرسال
            response.json().then(data => {
                if (data && data.errors) {
                    alert("❌ عذراً، حدث خطأ في البيانات. تأكد من ملء جميع الحقول المطلوبة.");
                } else {
                    alert("❌ فشل الإرسال. يرجى التأكد من إعداد رابط Formspree.");
                }
                console.log('Formspree Error:', data);
            }).catch(() => {
                 alert("❌ فشل الإرسال. يرجى التحقق من اتصال الشبكة وإعداد Formspree.");
            });
        }
    })
    .catch(error => {
        // حالة فشل الاتصال (شبكة، إلخ)
        console.error('Fetch Error:', error);
        alert("❌ حدث خطأ في الاتصال بالشبكة. يرجى المحاولة لاحقاً.");
    })
    .finally(() => {
        // إعادة زر الإرسال لحالته الأصلية
        submitBtn.textContent = 'نعم، تأكيد';
        submitBtn.disabled = false;
    });
}
    </script>
    

    <script>
    // ******************************************************
    // *** منطق إخفاء وإظهار الناف بار بالتمرير (Smart Scroll) ***
    // ******************************************************
    
    // 1. تحديد متغير لتخزين آخر موقع للتمرير (scroll position)
    let lastScrollTop = 0;
    
    // 2. تحديد عنصر الناف بار (هو الـ div الذي يحمل fixed-top)
    // نستخدم querySelector لضمان اختيار العنصر الأب الصحيح
    const navbarElement = document.querySelector('.container-fluid.fixed-top');
    
    // 3. الحصول على ارتفاع الناف بار لضمان عدم إخفائه فوراً عند التمرير قليلاً
    const navbarHeight = navbarElement ? navbarElement.offsetHeight : 0; 

    // إضافة مستمع لحدث التمرير (Scroll Event) على النافذة
    window.addEventListener('scroll', function() {
        
        // الحصول على الموقع الحالي للتمرير
        let currentScroll = window.pageYOffset || document.documentElement.scrollTop;

        // التحقق مما إذا كان الناف بار موجوداً
        if (navbarElement) {
            
            if (currentScroll > lastScrollTop && currentScroll > navbarHeight) {
                // الحالة 1: التمرير للأسفل (Down Scrolling) 
                // ويجب أن نكون قد مررنا مسافة تزيد عن ارتفاع الناف بار (لتجنب إخفائه فوراً)
                navbarElement.classList.add('navbar-hidden');
            } else {
                // الحالة 2: التمرير للأعلى (Up Scrolling) 
                // أو إذا كنا في أعلى الصفحة
                navbarElement.classList.remove('navbar-hidden');
            }
        }
        
        // تحديث آخر موقع للتمرير
        lastScrollTop = currentScroll <= 0 ? 0 : currentScroll;
    }, false); 
    
</script>

<script>
    // ******************************************************
    // *** منطق إظهار زر "العودة للأعلى" بالتمرير ***
    // ******************************************************

    // 1. تحديد زر "العودة للأعلى"
    const backToTopButton = document.querySelector('.back-to-top');

    // 2. تحديد مسافة التمرير التي يجب تجاوزها للإظهار (مثلاً: 200 بكسل)
    const scrollThreshold = 200; 

    // إضافة مستمع لحدث التمرير (Scroll Event) على النافذة
    window.addEventListener('scroll', function() {
        
        // الحصول على الموقع الحالي للتمرير
        // window.scrollY هو المفضل، أو window.pageYOffset إذا كان أقدم
        let currentScroll = window.scrollY || window.pageYOffset;

        // التحقق من موقع التمرير
        if (currentScroll > scrollThreshold) {
            // إذا تجاوزنا المسافة المطلوبة: أظهر الزر
            backToTopButton.classList.add('show');
        } else {
            // إذا كنا في أعلى الصفحة: أخفِ الزر
            backToTopButton.classList.remove('show');
        }
    });
</script>
 </body>
</html>



